<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Task Cups Prototype - Pollution Urgency</title>
<script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.js"></script>
<style>
  body { margin: 0; background: #000; color: #fff; font-family: sans-serif; }
  #checklist { position: fixed; top: -30px; left: 10px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; display: none; }
  #toggleTextBtn, #toggleMobileBtn, #toggleSubtaskBtn {
    position: fixed; top: 10px; padding: 10px; background: #222; color: #fff; border: none; border-radius: 5px; cursor: pointer;
  }
  #toggleTextBtn { right: 10px; }
  #toggleMobileBtn { right: 200px; }
  #toggleSubtaskBtn { right: 350px; }
</style>
</head>
<body>
<div id="checklist">
  <strong>Setup Checklist</strong>
  <ul>
    <li id="cupsCreated">Cups created</li>
    <li id="particlesCreated">Particles created</li>
    <li id="animationRunning">Animation running</li>
    <li id="urgencyColor">Urgency color mapping</li>
  </ul>
</div>

<button id="toggleTextBtn">Hide Cup Titles & Deadlines</button>
<button id="toggleMobileBtn">Enable Mobile View</button>
<button id="toggleSubtaskBtn">Show Subtask Titles</button>

<script>
let cups = [];
let maxRipple = 60;
let showCupText = false;
let mobileView = false;
let showSubtaskTitles = false;
let touchStartTime = 0;
let longPressDuration = 500; // ms
let tappedParticle = null;

// --- Main Tasks ---
// --- Subtle Momentum-Building Main Tasks (Only one Start:*high stress*) ---
let mainTasks = [
  {
    title: "Successful Workday at Trampoline Park",
    deadline: "2025-10-04T18:00:00",
    subtasks: [
      "Start: Check over party schedules and confirm bookings*high stress*",
      "Print out any sheets/forms needed for parties",
      "Address any employee lateness calmly but firmly",
      "Observe arrival times of employees discreetly",
      "Group employees at regular intervals to ensure smooth flow",
      "Prepare TV edits and have them ready for later",
      "Find and print out any forms the boss might need",
      "Assist wherever small gaps appear without creating new chaos",
      "Do a quick check of supplies and safety measures",
      "Reflect at end of day: Did the park operate smoothly and profit goal met?"
    ]
  },

  {
    title: "Clean Up Life From The Room to The Fire",
    deadline: "2025-09-02T18:00:00",
    subtasks: [
      "Go to Facebook and find form information",
      "Figure out what to do next",
      "Monologue",
      "Second monologue",
      "Build Baseline",
      "Clear Mental Clutter",
      "take a pee",
      "prepare for work",
      "monologue #3",
      "list the assets you have and are in control of already, and place them together"
    ]
  },

  {
    title: "Create A Business Card",
    deadline: "2025-09-02T19:00:00",
    subtasks: [
      "Design card",
      "Print batch",
      "Post on social media",
      "Start Mock Up A Penciled Design"
    ]
  },

  {
    title: "Clean Room",
    deadline: "2025-09-02T21:30:00",
    subtasks: [
      "Pick up clothes",
      "Vacuum floor",
      "Organize desk",
      "Pick up tools from biking session",
      "air out room",
      "get rid of containers of waste",
      "make drawing space",
      "add the ability to play sound when charging phone"
    ]
  },

  {
    title: "Fatten up 盛時",
    deadline: "2025-09-30T23:59:59",
    subtasks: [
      "Bring cash and wall down the road",
      "Walk to the Tim Hortons nearby",
      "Go to the bank beside the Tim Hortons and deposit cash",
      "Pick up some dog treats while there",
      "Walk back along the park path to get 盛時 some fresh air",
      "Prepare 盛時’s food while humming a tune",
      "Feed 盛時 his first meal",
      "Wash the dishes used for 盛時’s meal",
      "Take 盛時 out for a 10-minute walk to digest",
      "Reflect briefly on the day’s wins before logging the meal"
    ]
  },

  {
    title: "Purchase Automatic 2008 Hyundai Tiburon",
    deadline: "2025-09-03T12:00:00",
    subtasks: [
      "Withdraw $4,000",
      "Wait for Aerosports Paycheck to arrive",
      "Visit RBC bank for confirmation",
      "Plan how to get to Toronto cheaply",
      "Check listings and set alerts for Hyundai Tiburon",
      "Confirm travel route for pickup",
      "Review the car condition checklist",
      "Execute purchase plan carefully"
    ]
  },

  {
    title: "Make Staircase for 盛時 out the Window",
    deadline: "2025-09-03T14:00:00",
    subtasks: [
      "Sketch initial staircase design",
      "Do measurements of window height",
      "Measure floor and landing area",
      "Cut first piece of wood or cardboard for test",
      "Assemble prototype frame loosely",
      "Test stability by weight or small object",
      "Refine design based on test",
      "Finalize structure ready for installation"
    ]
  },

  {
    title: "Fireman Discipline",
    deadline: "2025-09-04T06:00:00",
    subtasks: [
      "Wake up at 6am sharp",
      "Morning run with 盛時 along familiar route",
      "Take cold shower while counting breaths",
      "Carry weight pack for 20 minutes",
      "Log completion of morning routine",
      "Reflect on how this builds readiness"
    ]
  },

  {
    title: "Boxer’s Daily Routine",
    deadline: "2025-09-04T20:00:00",
    subtasks: [
      "Shadowbox 3 rounds",
      "Bag work 5 rounds",
      "Core workout: 3 exercises",
      "Stretch + cool down",
      "Record progress in journal",
      "Visualize winning next bout"
    ]
  },

  {
    title: "Strengthen Family Connection",
    deadline: "2025-09-04T21:00:00",
    subtasks: [
      "Call Mom",
      "Text sibling one small message",
      "Plan visit for later this week",
      "Share one positive update verbally",
      "Write down any reflections on family connection"
    ]
  },

  {
    title: "Hit $200/day Consistency",
    deadline: "2025-09-05T18:00:00",
    subtasks: [
      "Morning job secured",
      "Afternoon job secured",
      "Submit hours / invoices",
      "Track total for the day",
      "Reflect: Did I cross $200?",
      "Plan adjustments for next day"
    ]
  },

  {
    title: "Design Keyboard-Like Car Transmission",
    deadline: "2025-10-10T18:00:00",
    subtasks: [
      "Sketch a random keyboard layout on scrap paper",
      "Map letters to simple forward/back motions",
      "Think about hand positioning translating to gear shifts",
      "Draft small prototype with cardboard or Lego",
      "Test mock-up using hand motions only",
      "Refine design to reduce finger movement fatigue",
      "Consult technical diagrams of car transmission",
      "Update prototype with feasibility tweaks",
      "Test virtual simulation if possible",
      "Document design for review"
    ]
  }
];





// --- Load / Save ---
function loadCompletedState(){ let saved = localStorage.getItem('completedParticles'); return saved ? JSON.parse(saved) : []; }
function saveCompletedState(){ let completed = []; for(let cup of cups){ completed.push(cup.particles.map(p => p.completed)); } localStorage.setItem('completedParticles', JSON.stringify(completed)); }

// --- Cup Class ---
class Cup {
  constructor(x, y, w, h, title, deadline, color){
    this.pos = createVector(x, y);
    this.w = w;
    this.h = h;
    this.title = title;
    this.deadline = new Date(deadline);
    this.color = color;
    this.particles = [];
    this.deadlineTotal = this.deadline - new Date();
  }
  addParticle(name, completed=false, highStress=false){
    let particle = new Particle(random(this.pos.x,this.pos.x+this.w), random(this.pos.y,this.pos.y+this.h), name, this, completed, highStress);
    this.particles.push(particle);
  }
  update(){
    for(let p of this.particles) p.update();
    if(showCupText){
      fill(255);
      textAlign(CENTER);
      textSize(windowWidth < 600 ? 18 : 14);
      text(this.title, this.pos.x + this.w/2, this.pos.y - 10);
      text("Deadline: " + this.deadline.toLocaleString(), this.pos.x + this.w/2, this.pos.y + this.h + 15);
    }
  }
}

// --- Particle Class ---
class Particle {
  constructor(x, y, name, cup, completed=false, highStress=false){
    this.pos = createVector(x, y);
    this.vel = createVector(random(-0.5,0.5), random(-0.5,0.5));
    this.r = 0.1;
    this.g = random(0.5,1);
    this.alpha = 150;
    this.name = name;
    this.cup = cup;
    this.completed = completed;
    this.fallSpeed = 2;
    this.urgency = 0;
    this.showNameUntil = 0;
    this.highStress = highStress;
    if(highStress){ this.baseColor = color(255,0,0); this.vel.mult(1.5); } 
    else { this.baseColor = cup.color; }
    this.setSizes();
  }

  setSizes(){
    if(mobileView || windowWidth < 600){ this.visualSize = 24; this.touchSize = 48; } 
    else { this.visualSize = 12; this.touchSize = 12; }
  }

  update(){
    if(!this.completed) this.pos.add(this.vel);
    if(this.pos.x < this.cup.pos.x){ this.pos.x = this.cup.pos.x; this.vel.x*=-1; }
    if(this.pos.x > this.cup.pos.x + this.cup.w){ this.pos.x = this.cup.pos.x + this.cup.w; this.vel.x*=-1; }
    if(this.pos.y < this.cup.pos.y){ this.pos.y = this.cup.pos.y; this.vel.y*=-1; }
    if(this.pos.y > this.cup.pos.y + this.cup.h){ this.pos.y = this.cup.pos.y + this.cup.h; this.vel.y*=-1; }

    // urgency
    if(!this.completed){
      let now = new Date();
      let remaining = this.cup.deadline - now;
      let sourceUrgency = constrain(1 - remaining / this.cup.deadlineTotal, 0, 1);
      this.urgency += (sourceUrgency - this.urgency) * 0.02;
      for(let other of this.cup.particles){
        if(!other.completed && other!==this && dist(this.pos.x,this.pos.y,other.pos.x,other.pos.y)<50){
          other.urgency += (this.urgency-other.urgency)*0.01;
          other.urgency = constrain(other.urgency,0,1);
        }
      }
      this.color = lerpColor(this.baseColor, color(255,0,0), this.urgency);
    }

    // ripple
    if(!this.completed){
      blendMode(ADD);
      noFill();
      stroke(this.color.levels[0], this.color.levels[1], this.color.levels[2], this.alpha);
      strokeWeight(2);
      ellipse(this.pos.x, this.pos.y, this.r*2);
      this.r += this.g * (this.highStress ? 1.5 : 1);
      this.alpha = map(this.r,0,maxRipple,150,0);
      if(this.r>maxRipple){ this.r=0.1; this.alpha=150; }
      blendMode(NORMAL);
    }

    // draw particle
    noStroke();
    fill(this.completed?"green":this.color);
    let targetY = this.completed?this.cup.pos.y+this.cup.h-6:this.pos.y;
    if(this.completed && this.pos.y<targetY){ this.pos.y+=this.fallSpeed; if(this.pos.y>targetY)this.pos.y=targetY; }
    ellipse(this.pos.x,this.pos.y,this.visualSize);

    // show titles: mobile tap, toggle, or high-urgency/high-stress
    if((mobileView && millis()<this.showNameUntil) || showSubtaskTitles || this.highStress || this.urgency>0.8){
      fill((this.highStress || this.urgency>0.8)?"red":"white");
      textAlign(CENTER);
      textSize(16);
      text(this.name,this.pos.x,this.pos.y-25);
    }
  }

  toggleCompletion(){ this.completed=!this.completed; if(!this.completed)this.urgency=0; saveCompletedState(); }
}

// --- Setup ---
function setup(){
  createCanvas(windowWidth, windowHeight);
  background(0);
  let startX = 150, startY = 150, spacingX = 250, spacingY = 250; // added spacingY
  let cupsPerRow = 3; // how many cups per row
  let completedState = loadCompletedState();
  
  // extended colors (you already added more)
  let cupColors = [
    color(255,128,0),
    color(0,200,255),
    color(255,0,255),
    color(128,0,255),
    color(25,100,255),
    color(0,255,128) // optional: extra so you don’t repeat too soon
  ];
  
  for(let i=0;i<mainTasks.length;i++){
    let t = mainTasks[i];
    let col = i % cupsPerRow;
    let row = Math.floor(i / cupsPerRow);
    let x = startX + col * spacingX;
    let y = startY + row * spacingY;
    
    let cup = new Cup(x, y, 150, 150, t.title, t.deadline, cupColors[i % cupColors.length]);
    
    t.subtasks.forEach((taskName,idx)=>{
      let completed = completedState[i] ? completedState[i][idx] : false;
      let highStress = false;
      if(taskName.includes("*high stress*")) {
        highStress = true;
        taskName = taskName.split("*")[0];
      }
      cup.addParticle(taskName, completed, highStress);
    });
    cups.push(cup);
  }

  document.getElementById("cupsCreated").style.color="lime";
  document.getElementById("particlesCreated").style.color="lime";
  document.getElementById("urgencyColor").style.color="lime";

  // Buttons
  document.getElementById("toggleTextBtn").addEventListener("click",()=>{
    showCupText=!showCupText;
    document.getElementById("checklist").style.display=showCupText?"block":"none";
    document.getElementById("toggleTextBtn").innerText = showCupText?"Hide Cup Titles & Deadlines":"Show Cup Titles & Deadlines";
  });

  document.getElementById("toggleMobileBtn").addEventListener("click",()=>{
    mobileView=!mobileView;
    cups.forEach(cup=>cup.particles.forEach(p=>p.setSizes()));
    document.getElementById("toggleMobileBtn").innerText = mobileView?"Disable Mobile View":"Enable Mobile View";
  });

  document.getElementById("toggleSubtaskBtn").addEventListener("click",()=>{
    showSubtaskTitles=!showSubtaskTitles;
    document.getElementById("toggleSubtaskBtn").innerText = showSubtaskTitles?"Hide Subtask Titles":"Show Subtask Titles";
  });
}


// --- Draw ---
function draw(){
  background(0,20);
  for(let cup of cups) cup.update();
  document.getElementById("animationRunning").style.color="lime";
}

// --- Touch ---
function touchStarted(){
  for(let cup of cups){
    for(let p of cup.particles){
      if(dist(touchX,touchY,p.pos.x,p.pos.y)<p.touchSize/2){
        tappedParticle=p;
        touchStartTime=millis();
        return false;
      }
    }
  }
  return true;
}

function touchEnded(){
  if(!tappedParticle) return true;
  let duration = millis() - touchStartTime;
  tappedParticle.toggleCompletion();
  if(mobileView && duration<longPressDuration) tappedParticle.showNameUntil=millis()+1000;
  tappedParticle=null;
  return false;
}

// --- Mouse ---
function mousePressed(){
  for(let cup of cups){
    for(let p of cup.particles){
      if(dist(mouseX,mouseY,p.pos.x,p.pos.y)<p.touchSize/2){ p.completed=true; saveCompletedState(); }
    }
  }
}
function mousePressedRight(e){
  e.preventDefault();
  for(let cup of cups){
    for(let p of cup.particles){
      if(dist(mouseX,mouseY,p.pos.x,p.pos.y)<p.touchSize/2){ p.completed=false; p.urgency=0; saveCompletedState(); }
    }
  }
  return false;
}
document.addEventListener("contextmenu", mousePressedRight);
</script>
</body>
</html>

